# Proxy for Live Without Belief API under /LWB/API
# Include this inside the aparat.feezor.net server block (both 80 and 443 if desired):
#   include snippets/lwb-api-proxy.conf;

location ^~ /LWB/API/ {
  include snippets/proxy-headers.conf;
  proxy_read_timeout 60s;
  proxy_send_timeout 60s;
  proxy_pass http://127.0.0.1:4433/;

  # Conservative caching and CORS for app API
  more_clear_headers Cache-Control;
  add_header Cache-Control "no-store, no-cache, must-revalidate, max-age=0" always;
  add_header Pragma "no-cache" always;
  add_header Expires "0" always;
  add_header Access-Control-Allow-Origin * always;
  add_header Access-Control-Allow-Methods "GET, POST, OPTIONS" always;
  add_header Access-Control-Allow-Headers "Content-Type, Authorization" always;
  if ($request_method = OPTIONS) { return 204; }
}