# Proxy for LWB Admin UI and Admin API under /LWB/Admin
# Include this inside the aparat.feezor.net server block:
#   include snippets/lwb-admin-proxy.conf;

# Admin UI (static HTML/CSS/JS served by Node at /admin/ui)
location ^~ /LWB/Admin/ {
  include snippets/proxy-headers.conf;
  proxy_read_timeout 60s;
  proxy_send_timeout 60s;
  # Map /LWB/Admin/ -> /admin/ui/
  proxy_pass http://127.0.0.1:4433/admin/ui/;

  # No caching for HTML; assets get short cache from Express static
  more_clear_headers Cache-Control;
  add_header Cache-Control "no-store, no-cache, must-revalidate, max-age=0" always;
}

# Admin UI uploads (icons)
location ^~ /LWB/Admin/uploads/ {
  include snippets/proxy-headers.conf;
  proxy_read_timeout 60s;
  proxy_send_timeout 60s;
  # Map /LWB/Admin/uploads/ -> /admin/ui/uploads/
  proxy_pass http://127.0.0.1:4433/admin/ui/uploads/;

  # Allow long caching for static uploads
  more_clear_headers Cache-Control;
  add_header Cache-Control "public, max-age=31536000, immutable" always;
}

# Admin API (JWT-protected)
location ^~ /v1/admin/ {
  include snippets/proxy-headers.conf;
  proxy_read_timeout 60s;
  proxy_send_timeout 60s;
  proxy_pass http://127.0.0.1:4433/v1/admin/;

  # CORS if needed for alternative origins (kept minimal since UI served same origin)
  add_header Access-Control-Allow-Origin * always;
  add_header Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS" always;
  add_header Access-Control-Allow-Headers "Content-Type, Authorization" always;
  if ($request_method = OPTIONS) { return 204; }
}
